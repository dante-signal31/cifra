#!/usr/bin/env python

import sys
import traceback

if sys.version_info.major < 3:
    import ci_tools as tools
    from .ci_constants import *
else:
    import ci_tools as tools
    from ci_constants import *

SCRIPT_TEXT = "#!/usr/bin/env bash\n\n " \
              "\n" \
              "# DO NOT EDIT DIRECTLY THIS FILE AS IT IS AUTOMATICALLY GENERATED BY\n" \
              "# ci_scripts/create_postinst_script SCRIPT.\n" \
              "\n" \
              "# Link cifra executable from /usr/bin.\n" \
              "ln -s /opt/cifra/bin/cifra /usr/bin/cifra\n\n" \
              "# Copy man page to /usr/share/man/man1\n" \
              "cp /opt/cifra/lib/python{python_version}/site-packages/cifra-{app_version}-py{python_version}.egg/share/man/man1/{app_name}.1.gz " \
              "/usr/share/man/man1/.\n"""

if __name__ == '__main__':
    try:
        parameters = {}
        parameters["python_version"] = tools.get_python_version_to_package(VDIST_CONFIGURATION)
        parameters["app_version"] = tools.get_current_version(VDIST_CONFIGURATION)
        parameters["app_name"] = tools.get_app_name(VDIST_CONFIGURATION)
        current_script = SCRIPT_TEXT.format(**parameters)
        with open(PACKAGING_POSTINSTALL_SCRIPT, "w") as file:
            file.write(current_script)
        print("Created {} file with contents:\n{}\n\n".format(PACKAGING_POSTINSTALL_SCRIPT,
                                                              current_script))
    except:
        traceback.print_exc(file=sys.stdout)
        sys.exit(1)
    else:
        sys.exit(0)
